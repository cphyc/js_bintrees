<!doctype html>
<html>
<head>
    <title>simple browser test</title>
    <script src="../dist/rbtree_by_index.js"></script>
    <script src="../test/fixtures.js"></script>
    <script>

    var checkEquality = function(tree, array) {
      var index = 0;
      tree.each(function(data) {
        if (data !== array[index++]) {
          //break here
          console.log('Expected \'' + data + '\' to equal \'' + array[index-1] + '\'');
        }
      });
    };

    var printTree = function(tree, node) {
      console.log('Printing tree');
      if (tree.size === 0) {
        console.log('Empty tree');
        return;
      }
      var next = tree._root.min_tree();
      var depth;
      var str, i;
      var index = 0;
      while (next) {
        depth = next.depth();
        for (str = index++ + '', i = 0; i < depth; str += '\t', i++) {}

        str += (next === node? '->': '');
        if (next.parent && next.parent.left === next) {
          str += '/';
        } else if (next.parent && next.parent.right === next) {
          str += '\\';
        } else {
          str += '->';
        }

        str += next.data;
        str += (next.red? '' : '(B)');
        str += ' w: ' + next.weight;
        console.log(str);
        next = next.successor();
      }
    };

    var tree = new RBTreeByIndex();
    var array = [];
    var position;

    var toInsert = [];
    for (var i = 0; i < 5; i++) {
      toInsert.push(Math.floor(Math.random() * i));
    }

    var pre = 'I:';
    toInsert.map(function(pos, index) {
      console.log('tree.insert(' + pos + ', \'' + pre + index + '\')');
      return pos;
    }).forEach(function(pos, index) {
      printTree(tree);

      console.log('Inserting', pos);
      tree.insert(pos,  pre + index);
      array.splice(pos, 0,  pre + index);

      checkEquality(tree, array);

    });

    // Then remove some randomly
    var toRemove = [];
    for (var i = 0; i < 4; i++) {
      toRemove.push(Math.floor(Math.random() * (tree.size-i)));
    }

    toRemove.map(function(pos) {
      console.log('tree.remove(' + pos + ')');
      return pos;
    }).forEach(function(pos) {
      printTree(tree);

      console.log('Removing', pos);
      tree.remove(pos);
      array.splice(pos, 1);

      checkEquality(tree, array);

    });
    </script>
</head>
<body>
    This test just makes sure the script loads and <em>something</em> works. More comprehensive tests are located in the /test directory.
</body>
</html>
